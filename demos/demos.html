<html>

<head>
    <meta charset="utf-8">
    <title>Custom Element Builder - Demo</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
</head>

<body>

    <div id="mocha"></div>

    <!-- polyfills -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.5.2/webcomponents-lite.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/document-register-element/0.1.6/document-register-element.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.22.2/es6-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.22.2/es6-sham.min.js"></script>

    <!-- source -->
    <script src="ceb.js"></script>
    <script src="ceb-feature-template.js"></script>

    <script>
var template = '';
template += '<em ceb-ref="fromNode" class="from"></em> say hello <em class="to"></em>!';
template += '<br>';
template += '<button>or to the world</button>';

ceb()
    .name('saying-hello')
    .feature(cebFeatureTemplate, {
        template: template
    })
    .properties({
        from: {
            attribute: true,
            setter: function (el, value) {
              console.log(el);
              cebFeatureTemplate(el).fromNode.textContent = value;
              return value;
            }
        },
        to: {
            attribute: true,
            delegate: {
                target: 'em.to',
                property: 'textContent'
            }
        }
    })
    .intercept('from', function (next, el, value) {
        return next(value.toUpperCase());
    })
    .intercept('to', function (next, el, value) {
        return next(value.toUpperCase());
    })
    .methods({
        sayHello: function (el, to) {
            return el.from + ' say hello ' + (to || el.to) + '!';
        }
    })
    .wrap('sayHello', function (next, el, to) {
        var newArguments = [next, el, (to || '').toUpperCase()];
        var result = next(newArguments);
        alert(result);
        return result;
    })
    .listen('click button', function (el) {
        el.sayHello('world');
    })
    .register();

var sayingHello = document.createElement('saying-hello');
sayingHello.setAttribute('from', 'I');
sayingHello.to = 'you';
document.body.appendChild(sayingHello);
    </script>
</body>

</html>
